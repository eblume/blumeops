global:
  scrape_interval: 15s
  evaluation_interval: 15s

# Indri system metrics are pushed via Alloy remote_write
# K8s services are scraped directly

scrape_configs:
  # Sifaka NAS exporters (via Caddy L4 TCP proxy on indri)
  - job_name: "node-exporter-sifaka"
    static_configs:
      - targets: ["nas.ops.eblu.me:9100"]
    metric_relabel_configs:
      - target_label: cluster
        replacement: indri

  - job_name: "smartctl-sifaka"
    scrape_interval: 60s
    static_configs:
      - targets: ["nas.ops.eblu.me:9633"]
    metric_relabel_configs:
      - target_label: cluster
        replacement: indri

  # CNPG PostgreSQL metrics (k8s internal)
  - job_name: "cnpg-postgres"
    static_configs:
      - targets: ["blumeops-pg-metrics-tailscale.databases.svc.cluster.local:9187"]
        labels:
          instance: "blumeops-pg"
    metric_relabel_configs:
      - target_label: cluster
        replacement: indri

  # Prometheus self-monitoring
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]
    metric_relabel_configs:
      - target_label: cluster
        replacement: indri

  # Loki metrics
  - job_name: "loki"
    static_configs:
      - targets: ["loki.monitoring.svc.cluster.local:3100"]
    metric_relabel_configs:
      - target_label: cluster
        replacement: indri

  # Kubernetes state metrics (pods, deployments, resource usage, etc.)
  - job_name: "kube-state-metrics"
    static_configs:
      - targets: ["kube-state-metrics.monitoring.svc.cluster.local:8080"]
    metric_relabel_configs:
      - target_label: cluster
        replacement: indri

  # Frigate NVR metrics (via Caddy on indri â€” Frigate runs on ringtail)
  - job_name: "frigate"
    scheme: https
    static_configs:
      - targets: ["nvr.ops.eblu.me"]
    metrics_path: /api/metrics
    metric_relabel_configs:
      - target_label: cluster
        replacement: ringtail
