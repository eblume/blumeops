#!/usr/bin/env bash
#MISE description="Preview DNS changes to eblu.me with Pulumi"

set -euo pipefail

GANDI_PERSONAL_ACCESS_TOKEN=$(op --vault vg6xf6vvfmoh5hqjjhlhbeoaie item get mco6ka3dc3rmw7zkg2dhia5d2m --fields pat --reveal)
export GANDI_PERSONAL_ACCESS_TOKEN

cd "$(dirname "$0")/../pulumi/gandi"
uv sync --quiet || { echo "uv sync failed â€” if devpi is down, run 'devpi off' and retry"; exit 1; }
pulumi stack select eblu-me
pulumi preview "$@"
